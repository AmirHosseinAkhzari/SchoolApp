<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>ูพูู ุขุณุชู</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Delete confirmation modal -->
    <div class="popup-overlay" id="deletePopup">
      <div class="popup-box">
        <h3>ุญุฐู ฺฉูุงุณ</h3>
        <p>
          ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุงู ฺฉูุงุณ ุฑุง ุญุฐู ฺฉูุฏุ<br />
          ุจุง ุงูุฌุงู ุงู ฺฉุงุฑุ ุชูุงู ุฏุงุฏูโูุง ูุฑุชุจุท ุจุง ุงู ฺฉูุงุณ โ ุงุฒ ุฌููู ููุฑุณุช ุฏุงูุดโุขููุฒุงู ู ุณูุงุจู ุญุถูุฑ ู ุบุงุจ ุขูโูุง โ ุจุฑุง ููุดู ูพุงฺฉ ุฎูุงููุฏ ุดุฏ.
        </p>
        <div class="popup-buttons">
          <button id="cancelDelete">ุงูุตุฑุงู</button>
          <button id="confirmDelete">ุจููุ ุญุฐู ุดูุฏ</button>
        </div>
      </div>
    </div>

    <!-- Student edit modal -->
    <div class="popup-overlay full" id="editStudentPopup">
      <div class="popup-box full-box">
        <header class="student-header centered">
          <div class="profile-container">
            <img
              id="studentPhotoPreview"
              src="https://i.pravatar.cc/150?u=default"
              alt="profile"
              class="profile-big"
            />
            <button class="edit-photo-btn" id="editPhotoBtn">
              <img src="icons/edit.svg" alt="edit" />
            </button>
            <input type="file" id="studentPhoto" accept="image/*" hidden />
          </div>
          <div class="student-header-text">
            <h2>ูุฑุงุด ุฏุงูุดโุขููุฒ</h2>
            <p>ุงุทูุงุนุงุช ุงู ุฏุงูุดโุขููุฒ ุฑุง ูุฑุงุด ฺฉูุฏ</p>
          </div>
        </header>

        <form id="editStudentForm" class="student-form-scroll">
          <div class="form-grid">
            <div class="form-row">
              <label for="studentFirstName">ูุงู</label>
              <input type="text" id="studentFirstName" />
            </div>
            <div class="form-row">
              <label for="studentLastName">ูุงู ุฎุงููุงุฏฺฏ</label>
              <input type="text" id="studentLastName" />
            </div>
            <div class="form-row">
              <label for="studentBirth">ุชุงุฑุฎ ุชููุฏ (ุดูุณ)</label>
              <input type="text" id="studentBirth" placeholder="ฑดฐณ/ฐต/ฑฒ" maxlength="10" />
            </div>
            <div class="form-row">
              <label for="studentNid">ฺฉุฏ ูู</label>
              <input type="text" id="studentNid" />
            </div>
            <div class="form-row">
              <label for="studentNumber">ุดูุงุฑู ุฏุงูุดโุขููุฒ</label>
              <input type="text" id="studentNumber" />
            </div>
            <div class="form-row">
              <label for="studentParent">ุดูุงุฑู ูู</label>
              <input type="text" id="studentParent" />
            </div>
            <div class="form-row">
              <label for="studentHome">ุดูุงุฑู ููุฒู</label>
              <input type="text" id="studentHome" />
            </div>
            <div class="form-row">
              <label for="studentClass">ฺฉูุงุณ</label>
              <select id="studentClass">
                <option value="">ุงูุชุฎุงุจ ฺฉูุฏโฆ</option>
                <option>ููุชู</option>
                <option>ูุดุชู</option>
                <option>ููู</option>
                <option>ุฏูู ุฑุงุถ</option>
                <option>ุงุฒุฏูู ุชุฌุฑุจ</option>
              </select>
            </div>
          </div>
          <div class="popup-buttons" style="margin-top: 30px">
            <button type="button" id="cancelStudentEdit">ุงูุตุฑุงู</button>
            <button type="submit" id="confirmStudentEdit">ุฐุฎุฑู ุชุบุฑุงุช</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Student creation modal -->
    <div class="popup-overlay full" id="addStudentPopup">
      <div class="popup-box full-box">
        <header class="student-header centered">
          <div class="profile-container">
            <img
              id="addStudentPhotoPreview"
              src="https://i.pravatar.cc/150?u=new"
              alt="profile"
              class="profile-big"
            />
            <button class="edit-photo-btn" id="addPhotoBtn">
              <img src="icons/edit.svg" alt="edit" />
            </button>
            <input type="file" id="addStudentPhoto" accept="image/*" hidden />
          </div>
          <div class="student-header-text">
            <h2>ุงูุฒูุฏู ุฏุงูุดโุขููุฒ ุฌุฏุฏ</h2>
            <p>ุงุทูุงุนุงุช ุฏุงูุดโุขููุฒ ุฑุง ูุงุฑุฏ ฺฉูุฏ</p>
          </div>
        </header>

        <form id="addStudentForm" class="student-form-scroll">
          <div class="form-grid">
            <div class="form-row">
              <label for="addFirstName">ูุงู</label>
              <input type="text" id="addFirstName" placeholder="ูุซูุงู ุงูุฑุญุณู" />
            </div>
            <div class="form-row">
              <label for="addLastName">ูุงู ุฎุงููุงุฏฺฏ</label>
              <input type="text" id="addLastName" placeholder="ูุซูุงู ุงุฎุถุฑ" />
            </div>
            <div class="form-row">
              <label for="addBirth">ุชุงุฑุฎ ุชููุฏ (ุดูุณ)</label>
              <input type="text" id="addBirth" placeholder="ฑดฐณ/ฐต/ฑฒ" maxlength="10" />
            </div>
            <div class="form-row">
              <label for="addNid">ฺฉุฏ ูู</label>
              <input type="text" id="addNid" placeholder="ฐฐตถทณฒนดฑ" />
            </div>
            <div class="form-row">
              <label for="addNumber">ุดูุงุฑู ุฏุงูุดโุขููุฒ</label>
              <input type="text" id="addNumber" placeholder="ฑฒณดตถ" />
            </div>
            <div class="form-row">
              <label for="addParent">ุดูุงุฑู ูู</label>
              <input type="text" id="addParent" placeholder="ฐนฑฒณดตถทธน" />
            </div>
            <div class="form-row">
              <label for="addHome">ุดูุงุฑู ููุฒู</label>
              <input type="text" id="addHome" placeholder="ฐทฑตฒณดตถทธ" />
            </div>
            <div class="form-row">
              <label for="addClass">ฺฉูุงุณ</label>
              <select id="addClass">
                <option value="">ุงูุชุฎุงุจ ฺฉูุฏโฆ</option>
                <option>ููุชู</option>
                <option>ูุดุชู</option>
                <option>ููู</option>
                <option>ุฏูู ุฑุงุถ</option>
                <option>ุงุฒุฏูู ุชุฌุฑุจ</option>
              </select>
            </div>
          </div>
          <div class="popup-buttons" style="margin-top: 30px">
            <button type="button" id="cancelAddStudent">ุงูุตุฑุงู</button>
            <button type="submit" id="confirmAddStudent">ุงูุฒูุฏู</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Class edit modal -->
    <div class="popup-overlay" id="editPopup">
      <div class="popup-box">
        <h3>ูุฑุงุด ฺฉูุงุณ</h3>
        <p style="font-size: 13px; color: var(--text-muted)">ูุงู ุฌุฏุฏ ฺฉูุงุณ ุฑุง ูุงุฑุฏ ฺฉูุฏ:</p>
        <input type="text" id="editInput" placeholder="ูุงู ุฌุฏุฏ ฺฉูุงุณ..." />
        <div class="popup-buttons" style="margin-top: 30px">
          <button type="button" id="cancelEdit">ุงูุตุฑุงู</button>
          <button type="button" id="confirmEdit">ุฐุฎุฑู</button>
        </div>
      </div>
    </div>

    <aside class="sidebar">
      <div class="logo-box">
        <div class="logo">
          <img src="logo.png" alt="Astin" />
        </div>
        <div class="title-wrap">
          <span class="name">ุขุณุชู</span>
          <span class="sub">ูพูู ูุฏุฑุช</span>
        </div>
      </div>
      <div class="menu">
        <div class="item active" data-page="dashboard">ุฏุงุดุจูุฑุฏ</div>
        <div class="item" data-page="attendance">ุญุถูุฑ ู ุบุงุจ</div>
        <div class="item" data-page="students">ุฏุงูุดโุขููุฒูุง</div>
        <div class="item" data-page="classes">ฺฉูุงุณโูุง</div>
        <div class="item" data-page="settings">ุชูุธูุงุช</div>
      </div>
    </aside>

    <div class="main">
      <header class="topbar">
        <div class="top-left">
          <span>ุณูุงูุ ุงูุฑุญุณู ๐</span>
        </div>
        <div style="display: flex; gap: 10px; align-items: center">
          <div class="profile">
            <div class="avatar"></div>
            <div class="name">Admin</div>
          </div>
        </div>
      </header>

      <main class="content" id="content">
        <h2 style="margin: 0 0 4px">ุฏุงุดุจูุฑุฏ</h2>
        <p style="margin: 0 0 12px; color: var(--text-muted); font-size: 13px">ููุง ฺฉู ุณุงูุงูู ุญุถูุฑ ู ุบุงุจ ุขุณุชู</p>
        <div class="cards">
          <div class="card">
            <div class="card-title">ุญุถูุฑ ุงูุฑูุฒ</div>
            <div class="card-value">โ</div>
          </div>
          <div class="card">
            <div class="card-title">ุบุจุชโูุง</div>
            <div class="card-value">โ</div>
          </div>
          <div class="card">
            <div class="card-title">ุฏุงูุดโุขููุฒ ูุนุงู</div>
            <div class="card-value">โ</div>
          </div>
          <div class="card">
            <div class="card-title">ุขุฎุฑู ููฺฏุงูโุณุงุฒ</div>
            <div class="card-value" style="font-size: 12px">ุฏุฑุญุงูโุจุงุฑฺฏุฐุงุฑโฆ</div>
          </div>
        </div>
        <div class="placeholder">ุงูุฌุง ุจุนุฏุงู ุฌุฏูู ุญุถูุฑ / ูููุฏุงุฑ / ูุณุช ุฑู ูโุฐุงุฑู</div>
      </main>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Cached DOM references
        const content = document.getElementById('content');
        const menuItems = document.querySelectorAll('.menu .item');
        const deletePopup = document.getElementById('deletePopup');
        const editPopup = document.getElementById('editPopup');
        const editStudentPopup = document.getElementById('editStudentPopup');
        const addStudentPopup = document.getElementById('addStudentPopup');
        const studentPhotoInput = document.getElementById('studentPhoto');
        const addStudentPhotoInput = document.getElementById('addStudentPhoto');

        // Shared component state
        const state = {
          currentRowForDelete: null,
          currentClassRow: null,
          currentStudentRow: null,
        };

        // Templates for each navigation page
        const templates = {
          dashboard: `
            <h2 style="margin:0 0 4px;">ุฏุงุดุจูุฑุฏ</h2>
            <p style="margin:0 0 12px; color:var(--text-muted); font-size:13px;">ููุง ฺฉู ุณุงูุงูู ุญุถูุฑ ู ุบุงุจ ุขุณุชู</p>
            <div class="cards">
              <div class="card"><div class="card-title">ุญุถูุฑ ุงูุฑูุฒ</div><div class="card-value">โ</div></div>
              <div class="card"><div class="card-title">ุบุจุชโูุง</div><div class="card-value">โ</div></div>
              <div class="card"><div class="card-title">ุฏุงูุดโุขููุฒ ูุนุงู</div><div class="card-value">โ</div></div>
              <div class="card"><div class="card-title">ุขุฎุฑู ููฺฏุงูโุณุงุฒ</div><div class="card-value" style="font-size:12px;">ุฏุฑุญุงูโุจุงุฑฺฏุฐุงุฑโฆ</div></div>
            </div>
            <div class="placeholder" style="margin-top:14px;">ุงูุฌุง ุจุนุฏุงู ุฌุฏูู ุญุถูุฑ / ูููุฏุงุฑ / ูุณุช ุฑู ูโุฐุงุฑู</div>
          `,
          attendance: `
            <h2>ุญุถูุฑ ู ุบุงุจ</h2>
            <p style="color:var(--text-muted); font-size:13px;">ูุณุช ุขุฎุฑู ฺฉุงุฑุชโุฒูโูุง</p>
            <div class="placeholder">ูุณุช ฺฉุงุฑุชโูุง (ุจุนุฏุงู ุงุฒ API ูพุฑ ูโฺฉูู)</div>
          `,
          students: () => {
            const studentsData = [
              { firstName: 'ุงูุฑุญุณู', lastName: 'ุงุฎุถุฑ', className: 'ูุดุชู', profileLink: 'https://i.pravatar.cc/150?u=1', id: 'stu1' },
              { firstName: 'ุนู', lastName: 'ุฑุถุง', className: 'ูุดุชู', profileLink: 'https://i.pravatar.cc/150?u=2', id: 'stu2' },
              { firstName: 'ูุญูุฏ', lastName: 'ุญุณู', className: 'ููู', profileLink: 'https://i.pravatar.cc/150?u=3', id: 'stu3' },
            ];

            const rows = studentsData
              .map((student, index) => `
                <tr>
                  <td>${index + 1}</td>
                  <td><img src="${student.profileLink}" class="profile-pic" alt="profile" /></td>
                  <td>${student.className}</td>
                  <td>${student.firstName}</td>
                  <td>${student.lastName}</td>
                  <td class="actions">
                    <button class="edit-btn" data-id="${student.id}"><img src="icons/edit.svg" alt="edit" /></button>
                    <button class="delete-btn"><img src="icons/delete.svg" alt="delete" /></button>
                  </td>
                </tr>
              `)
              .join('');

            return `
              <h2 style="margin:0;">ุฏุงูุดโุขููุฒุงู</h2>
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                <p style="color:var(--text-muted); font-size:13px;">ูุฏุฑุช ุงุทูุงุนุงุช ุฏุงูุดโุขููุฒุงู</p>
                <button id="addStudentBtn" class="add-btn">โ ุงูุฒูุฏู ุฏุงูุดโุขููุฒ</button>
              </div>
              <div class="table-wrap">
                <table class="class-table students-table align-fix">
                  <thead>
                    <tr><th>#</th><th>ุนฺฉุณ</th><th>ฺฉูุงุณ</th><th>ูุงู</th><th>ูุงู ุฎุงููุงุฏฺฏ</th><th>ุนููุงุช</th></tr>
                  </thead>
                  <tbody>${rows}</tbody>
                </table>
              </div>
            `;
          },
          classes: () => {
            const classesData = [
              { name: 'ููุชู' },
              { name: 'ูุดุชู' },
              { name: 'ููู' },
              { name: 'ุฏูู ุฑุงุถ' },
              { name: 'ุงุฒุฏูู ุชุฌุฑุจ' },
            ];

            const rows = classesData
              .map((cls, index) => `
                <tr>
                  <td>${index + 1}</td>
                  <td>${cls.name}</td>
                  <td class="actions">
                    <button class="edit-btn"><img src="icons/edit.svg" alt="edit" /></button>
                    <button class="delete-btn"><img src="icons/delete.svg" alt="delete" /></button>
                  </td>
                </tr>
              `)
              .join('');

            return `
              <h2>ฺฉูุงุณโูุง</h2>
              <p style="color:var(--text-muted); font-size:13px;">ูุฏุฑุช ฺฉูุงุณโูุง</p>
              <div class="table-wrap">
                <table class="class-table">
                  <thead><tr><th>#</th><th>ูุงู ฺฉูุงุณ</th><th>ุนููุงุช</th></tr></thead>
                  <tbody>${rows}</tbody>
                </table>
              </div>
            `;
          },
          settings: `
            <h2>ุชูุธูุงุช</h2>
            <p style="color:var(--text-muted); font-size:13px;">ุชูุธูุงุช ูพุงู ูพูู ุขุณุชู</p>
            <div class="placeholder">API key / ุขุฏุฑุณ ุณุฑูุฑ / ุชู</div>
          `,
        };

        // Render a specific page inside the content container
        const renderPage = (page) => {
          const template = templates[page];
          content.innerHTML = typeof template === 'function' ? template() : template;
        };

        // Toggle active state between menu buttons
        const setActiveMenuItem = (item) => {
          menuItems.forEach((menuItem) => menuItem.classList.remove('active'));
          item.classList.add('active');
        };

        // General popup helpers
        const openPopup = (popup) => {
          popup.classList.add('active');
          document.body.style.overflow = 'hidden';
        };

        const closePopup = (popup) => {
          popup.classList.remove('active');
          document.body.style.overflow = '';
        };

        // Menu navigation handling
        menuItems.forEach((item) => {
          item.addEventListener('click', () => {
            setActiveMenuItem(item);
            renderPage(item.dataset.page);
          });
        });

        // Delete confirmation workflow
        document.addEventListener('click', (event) => {
          const deleteButton = event.target.closest('.delete-btn');
          if (!deleteButton) {
            return;
          }

          state.currentRowForDelete = deleteButton.closest('tr');
          const activePage = document.querySelector('.menu .item.active').dataset.page;
          const popupTitle = deletePopup.querySelector('h3');
          const popupDescription = deletePopup.querySelector('p');

          if (activePage === 'students') {
            popupTitle.textContent = 'ุญุฐู ุฏุงูุดโุขููุฒ';
            popupDescription.innerHTML = 'ุจุง ุญุฐู ุงู ุฏุงูุดโุขููุฒุ ุชูุงู ุฏุงุฏูโูุง ุงู (ุญุถูุฑ ู ุบุงุจุ ุดูุงุฑู ฺฉุงุฑุช ู ...) ุจุฑุง ููุดู ูพุงฺฉ ูโุดูุฏ.';
          } else {
            popupTitle.textContent = 'ุญุฐู ฺฉูุงุณ';
            popupDescription.innerHTML = 'ุจุง ุญุฐู ุงู ฺฉูุงุณุ ุชูุงู ุฏุงูุดโุขููุฒุงู ู ุณูุงุจู ูุฑุชุจุท ุขู ุจุฑุง ููุดู ูพุงฺฉ ูโุดููุฏ.';
          }

          openPopup(deletePopup);
        });

        document.getElementById('cancelDelete').addEventListener('click', () => {
          state.currentRowForDelete = null;
          closePopup(deletePopup);
        });

        document.getElementById('confirmDelete').addEventListener('click', () => {
          if (state.currentRowForDelete) {
            state.currentRowForDelete.remove();
            state.currentRowForDelete = null;
          }
          closePopup(deletePopup);
        });

        // Edit class and student workflows
        document.addEventListener('click', (event) => {
          const editButton = event.target.closest('.edit-btn');
          if (!editButton) {
            return;
          }

          const activePage = document.querySelector('.menu .item.active').dataset.page;

          if (activePage === 'classes') {
            state.currentClassRow = editButton.closest('tr');
            const currentName = state.currentClassRow.children[1].innerText;
            document.getElementById('editInput').value = currentName;
            openPopup(editPopup);
            return;
          }

          if (activePage === 'students') {
            state.currentStudentRow = editButton.closest('tr');
            document.getElementById('studentPhotoPreview').src = state.currentStudentRow.children[1].querySelector('img').src;
            document.getElementById('studentClass').value = state.currentStudentRow.children[2].innerText;
            document.getElementById('studentFirstName').value = state.currentStudentRow.children[3].innerText;
            document.getElementById('studentLastName').value = state.currentStudentRow.children[4].innerText;
            openPopup(editStudentPopup);
          }
        });

        document.getElementById('cancelEdit').addEventListener('click', () => {
          state.currentClassRow = null;
          closePopup(editPopup);
        });

        document.getElementById('confirmEdit').addEventListener('click', () => {
          const newName = document.getElementById('editInput').value.trim();
          if (newName && state.currentClassRow) {
            state.currentClassRow.children[1].innerText = newName;
          }
          state.currentClassRow = null;
          closePopup(editPopup);
        });

        document.getElementById('cancelStudentEdit').addEventListener('click', () => {
          state.currentStudentRow = null;
          closePopup(editStudentPopup);
        });

        document.getElementById('editStudentForm').addEventListener('submit', (event) => {
          event.preventDefault();

          if (!state.currentStudentRow) {
            return;
          }

          const photoSrc = document.getElementById('studentPhotoPreview').src;
          const firstName = document.getElementById('studentFirstName').value.trim();
          const lastName = document.getElementById('studentLastName').value.trim();
          const className = document.getElementById('studentClass').value.trim();

          state.currentStudentRow.children[1].querySelector('img').src = photoSrc;
          state.currentStudentRow.children[2].innerText = className || 'โ';
          state.currentStudentRow.children[3].innerText = firstName || 'โ';
          state.currentStudentRow.children[4].innerText = lastName || 'โ';

          state.currentStudentRow = null;
          closePopup(editStudentPopup);
        });

        // Open add student popup from the students page
        document.addEventListener('click', (event) => {
          if (event.target.id === 'addStudentBtn') {
            document.getElementById('addStudentForm').reset();
            document.getElementById('addStudentPhotoPreview').src = 'https://i.pravatar.cc/150?u=new';
            openPopup(addStudentPopup);
          }
        });

        document.getElementById('cancelAddStudent').addEventListener('click', () => {
          closePopup(addStudentPopup);
        });

        // Photo handling for both modals
        document.getElementById('editPhotoBtn').addEventListener('click', () => {
          studentPhotoInput.click();
        });

        document.getElementById('addPhotoBtn').addEventListener('click', () => {
          addStudentPhotoInput.click();
        });

        const previewImage = (input, previewElementId) => {
          const file = input.files && input.files[0];
          if (!file) {
            return;
          }
          const reader = new FileReader();
          reader.onload = (event) => {
            document.getElementById(previewElementId).src = event.target.result;
          };
          reader.readAsDataURL(file);
        };

        studentPhotoInput.addEventListener('change', () => previewImage(studentPhotoInput, 'studentPhotoPreview'));
        addStudentPhotoInput.addEventListener('change', () => previewImage(addStudentPhotoInput, 'addStudentPhotoPreview'));

        // Date field validation shared between forms
        const datePattern = /^[0-9ฐ-น]{4}\/[0-9ฐ-น]{2}\/[0-9ฐ-น]{2}$/;
        const validateDate = (event) => {
          const value = event.target.value.trim();
          event.target.style.borderColor = value && !datePattern.test(value) ? '#e53935' : '';
        };

        document.getElementById('studentBirth').addEventListener('input', validateDate);
        document.getElementById('addBirth').addEventListener('input', validateDate);

        // Persist new student rows in the students table
        document.getElementById('addStudentForm').addEventListener('submit', (event) => {
          event.preventDefault();

          const firstName = document.getElementById('addFirstName').value.trim();
          const lastName = document.getElementById('addLastName').value.trim();
          const className = document.getElementById('addClass').value.trim();
          const photo = document.getElementById('addStudentPhotoPreview').src;

          if (!firstName || !lastName) {
            return;
          }

          const tableBody = document.querySelector('.students-table tbody');
          if (!tableBody) {
            closePopup(addStudentPopup);
            return;
          }

          const newRow = document.createElement('tr');
          newRow.innerHTML = `
            <td>${tableBody.children.length + 1}</td>
            <td><img src="${photo}" class="profile-pic" alt="profile" /></td>
            <td>${className}</td>
            <td>${firstName}</td>
            <td>${lastName}</td>
            <td class="actions">
              <button class="edit-btn"><img src="icons/edit.svg" alt="edit" /></button>
              <button class="delete-btn"><img src="icons/delete.svg" alt="delete" /></button>
            </td>
          `;

          tableBody.appendChild(newRow);
          closePopup(addStudentPopup);
        });

        // Render default dashboard view on initial load
        renderPage('dashboard');
      });
    </script>
  </body>
</html>
